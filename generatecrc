#!/usr/bin/env python3
import sys
import libscrc
import os

for i in sys.argv[1:]:
    name,ext = os.path.splitext(i)
    
    image_file = open(i,"rb")
    crc_file = open(name+"_crc"+ext,"wb")

    print("generating", name+"_crc"+ext, "...")

    while True:
        buf = image_file.read(32768)
        print(buf)
        if not buf:
            break
        for i in range(32768 - len(buf)):
            buf += b"\x00"
        crc = libscrc.ibm_sdlc(buf).to_bytes(2, "little")
        crc_file.write(crc)

    crc_file.close()
    image_file.close()
